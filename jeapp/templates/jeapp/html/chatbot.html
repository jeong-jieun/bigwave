{% load static %}
<!-- /*
* Template Name: Tour
* Template Author: Untree.co
* Tempalte URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="Untree.co">
	<link rel="shortcut icon" href="favicon.png">

	<meta name="description" content="" />
	<meta name="keywords" content="bootstrap, bootstrap4" />

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Source+Serif+Pro:wght@400;700&display=swap" rel="stylesheet">

	<link rel="stylesheet" href="{% static 'mgapp/css/bootstrap.min.css'%}">
	<link rel="stylesheet" href="{% static 'mgapp/css/owl.carousel.min.css'%}">
	<link rel="stylesheet" href="{% static 'mgapp/css/owl.theme.default.min.css'%}">
	<link rel="stylesheet" href="{% static 'mgapp/css/jquery.fancybox.min.css'%}">
	<link rel="stylesheet" href="{% static 'mgapp/fonts/icomoon/style.css'%}">
	<link rel="stylesheet" href="{% static 'mgapp/fonts/flaticon/font/flaticon.css'%}">
	<link rel="stylesheet" href="{% static 'mgapp/css/daterangepicker.css'%}">
	<link rel="stylesheet" href="{% static 'mgapp/css/aos.css'%}">
	<link rel="stylesheet" href="{% static 'mgapp/css/style.css'%}">

	<title>Tour Free Bootstrap Template for Travel Agency by Untree.co</title>
	
	{% comment %} 스타일 추가 부분 {% endcomment %}
	<style>
		.chat-message {
			width: 70%;
			margin: 10px;
			padding: 10px;
			border-radius: 10px;
			max-width: 70%;
		}
		.user-message {
			align-self: flex-end;
			background-color: #cce6ff;
		}
		.assistant-message {
			align-self: flex-start;
			background-color: #f0f0f0;
			margin-right: 0;
		}

		.chat-assistant {
			border: 2px ;
			width: 70%;
			margin: 10px;
			padding: 10px;
			border-radius: 10px;
			max-width: 70%;; /* 주황색 테두리 스타일 */}
	</style>



</head>

<body>

    <div class="site-mobile-menu site-navbar-target">
		<div class="site-mobile-menu-header">
			<div class="site-mobile-menu-close">
				<span class="icofont-close js-menu-toggle"></span>
			</div>
		</div>
		<div class="site-mobile-menu-body"></div>
	</div>

	<nav class="site-nav">

			<div class="site-navigation">
				<a href="/mg/home/" class="logo m-0">bigwave</a> 
				{% comment %} <span class="text-primary">bigwave</span> {% endcomment %}

				<ul class="js-clone-nav d-none d-lg-inline-block text-left site-menu float-right">
					<li class="active"><a href="/">선착장</a></li>
					<li><a href="services.html">Services</a></li>
					<li class="has-children">
						<a href="#">부가 서비스</a>
						<ul class="dropdown">
							<li class="has-children">
								<a href="#">선착장</a>
								<ul class="dropdown">
									<li><a href="#">다대선착장</a></li>
									<li><a href="#">동삼선착장</a></li>
									<li><a href="#">미포선착장</a></li>
									<li><a href="#">자갈치선착장</a></li>
								</ul>
							</li>
						</ul>
					</li>
					<li><a href="/login2/">로그인</a></li>
					<li><a href="/signup2/">회원가입</a></li>
				</ul>

				<a href="#" class="burger ml-auto float-right site-menu-toggle js-menu-toggle d-inline-block d-lg-none light" data-toggle="collapse" data-target="#main-navbar">
					<span></span>
				</a>

			</div>
	</nav>

    <script src="{% static 'mgapp/js/jquery-3.4.1.min.js'%}"></script>
	<script src="{% static 'mgapp/js/popper.min.js'%}"></script>
	<script src="{% static 'mgapp/js/bootstrap.min.js'%}"></script>
	<script src="{% static 'mgapp/js/owl.carousel.min.js'%}"></script>
	<script src="{% static 'mgapp/js/jquery.animateNumber.min.js'%}"></script>
	<script src="{% static 'mgapp/js/jquery.waypoints.min.js'%}"></script>
	<script src="{% static 'mgapp/js/jquery.fancybox.min.js'%}"></script>
	<script src="{% static 'mgapp/js/aos.js'%}"></script>
	<script src="{% static 'mgapp/js/moment.min.js'%}"></script>
	<script src="{% static 'mgapp/js/daterangepicker.js'%}"></script>

	<script src="{% static 'mgapp/js/typed.js'%}"></script>
	<script>
		$(function() {
			var slides = $('.slides'),
			images = slides.find('img');

			images.each(function(i) {
				$(this).attr('data-id', i + 1);
			})

			var typed = new Typed('.typed-words', {
				strings: ["다대포 ","영도 ","자갈치 ", "송도",],
				typeSpeed: 80,
				backSpeed: 80,
				backDelay: 4000,
				startDelay: 1000,
				loop: true,
				showCursor: true,
				preStringTyped: (arrayPos, self) => {
					arrayPos++;
					console.log(arrayPos);
					$('.slides img').removeClass('active');
					$('.slides img[data-id="'+arrayPos+'"]').addClass('active');
				}
			});
		})
	</script>

	<script src="{% static 'mgapp/js/custom.js'%}"></script>
     
</script>
<!-- jquery 자바스크립트 적용하기-->
<script type="text/javascript" 
		src = "https://code.jquery.com/jquery-3.6.0.min.js">
</script>
<script >
	messages=[]
	var isUserMessage = true;

function cc(){
	fm = document.getElementById("chatbotbox")
	const user_input = fm.chatbot.value;
	var header1 = document.getElementById('header-1');
	var newMessage1 = document.createElement('div');
	newMessage1.textContent = user_input;
	

	//추가 부분
	newMessage1.className = "chat-message";

	if (isUserMessage) {
		newMessage1.className = "chat-message user-message";
	} else {
		newMessage1.className = "chat-assistant assistant-message "; // chat-assistant 스타일 추가
	}

	header1.appendChild(newMessage1);
	isUserMessage = !isUserMessage;
	//요기까지

	alert("1");
	alert(user_input);
	messages.push({"role":"user","content":user_input});
	// var csrf_token = $("[name=csrfmiddlewaretoken]").val();
	messages1 = {
		user_input: user_input,
		messages:messages
	};
	messages2=JSON.stringify(messages1);
	alert(messages2);
    
    $.ajax({
		url: "/je/service/chatbot_back11/", 
		type:"post",
		contentType: "application/json; charset=utf-8",
        dataType: "json",
        data :messages2 ,
		success: function(data) {
			alert("33");
			alert(data["assistant_content"])
			//alert(data["user_input"])
			//alert(data["assistant_content"])
    		messages.push({"role":"assistant", "content":data["assistant_content"]})
			// 새로운 메시지를 생성하고 추가

			var newMessage2 = document.createElement('div');
			newMessage2.textContent = data["assistant_content"];

			if (isUserMessage) {
				newMessage2.className = "chat-message user-message";
			} else {
				newMessage2.className = "chat-assistant assistant-message"; // chat-assistant 스타일 추가
			}
			header1.appendChild(newMessage2);
			isUserMessage = !isUserMessage;




		}, beforeSend:function(){
			console.log("1111")
		}, complete:function(){
			console.log("22222")
		}, error:function(request, status, error){
			console.log("333333");
		}

    });
};

	
</script> 




<div id="header-1" style="width:100%; height:200px;">
	<br>
	<br>
	<br>
	<br>
	<!-- 사용자 메시지를 표시할 컨테이너 -->
	마자자자아요용?

</div>

<form action="#" id = "chatbotbox" method ="post">
	{% csrf_token%}
대화를 입력해주세요: <input type="text" name="question" id="chatbot">

</form>
<button onclick="cc()">전송해주세요</button>

</body>
